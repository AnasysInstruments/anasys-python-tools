# -*- encoding: utf-8 -*-
#
#  anasysdoc.py
#
#  Copyright 2017 Cody Schindler <cschindler@anasysinstruments.com>
#
#  This program is the property of Anasys Instruments, and may not be
#  redistributed or modified without explict permission of the author.

# import xml.etree.ElementTree as ET   #for parsing XML
# import gzip                          #for unzipping .axz files
# import os
import anasysfile
import heightmap
import irspectra
# import re

class AnasysDoc(anasysfile.AnasysFile):
    """Object for holding document data in a file generated by Analysis Studio"""
    def __init__(self, ftree):
        anasysfile.AnasysFile.__init__(self)
        self._skip_tags = {'HeightMaps':{},
                        #    'HeightMaps':self._get_height_maps,
                           'RenderedSpectra':{},
                           'SpectraChannelViews':{}}
        #1. get etree object from xml and convert to attributes
        # doc_root = self._get_etree(f_name)
        self._convert_tags(ftree)
        self.HeightMaps = self._get_height_maps(ftree.find('HeightMaps'))
        self.RenderedSpectra = self._get_rendered_spectra(ftree.find('RenderedSpectra'))
        # print(dir(self.RenderedSpectra['Spectrum 1'].DataChannels))
        #print(self.RenderedSpectra)#['Spectrum 1'].DataChannels.Name)
        #3. pull out Spectra
        #4. pull out anything else important

    def _get_rendered_spectra(self, spectra):
        """Returns a list of IRRenderedSpectra"""
        spectradict = {}
        for spectrum in spectra:
            key = spectrum.find('Label').text
            key = self._check_key(key, spectradict)
            spectradict[key] = irspectra.IRRenderedSpectra(spectrum)
        return spectradict

    def _get_height_maps(self, maps):
        """Takes an iterable of Height Maps, and returns a dict of HeightMap objects"""
        mapdict = {}
        for _map in maps:
            key = _map.get('Label')
            key = self._check_key(key, mapdict)
            mapdict[key] = heightmap.HeightMap(_map)
        return mapdict

###### FILE HANDLING STUFF SHOULD GO IN ITS OWN CLASS ######
